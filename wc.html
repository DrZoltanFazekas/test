<html>

<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />	
</head>
	
<body>

<script src="https://unpkg.com/@walletconnect/client@1.7.8/dist/umd/index.min.js"></script>
<script src="https://unpkg.com/@walletconnect/qrcode-modal@1.7.8/dist/umd/index.min.js"></script>

<script>

async function test() {

const connector = new WalletConnect.default({bridge: "https://bridge.walletconnect.org", qrcodeModal: WalletConnectQRCodeModal.default});

connector.on("connect", async (error, payload) => {
  if (error) throw error;
  const { accounts, chainId } = payload.params[0];
  console.log("connect", accounts, chainId);  
});

connector.on("session_update", async (error, payload) => {
  if (error) throw error;
  const { accounts, chainId } = payload.params[0];
  console.log("session_update", accounts, chainId);
});

connector.on("disconnect", async (error, payload) => {
  if (error) {throw error;}
  console.log("disconnect", payload);
});

const params = new URLSearchParams(window.location.search);

if (params.has('connect'))
  if (!connector.connected)
    connector.createSession();

if (params.has('disconnect'))
  if (connector.connected)
    connector.killSession();

const tx = {
  from: connector.accounts[0],
  to: "0x33f447ac72267Ae876C60a23A414c437Ff2e7109",
  data: "0xa9059cbb000000000000000000000000" + "ec9dd80a8c1188b388be65d8ae4364df67e6f4ae" + "0000000000000000000000000000000000000000000000000de0b6b3a7640000",
  gasPrice: "0x04540be400", // mandatory when using MetaMask, otherwise invalid amount
  //maxPriorityFeePerGas: "0x1", // EIP-1559 transaction field not recognized
  //maxFeePerGas: "0x02540be400", // EIP-1559 transaction field not recognized
};

if (params.has('sendTransaction'))
  connector.sendTransaction(tx)
    .then((result) => {console.log("sendTransaction", result);})
    .catch((error) => {console.error("sendTransaction", error);});

}

test();

</script>
</body>
</html>