<script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
<script>
var logs = "";
var oldLog = console.log;
console.log = function (message) {
	logs += "<p>"+JSON.stringify(arguments)+"</p>";
    oldLog.apply(console, arguments);
};

const provider = new ethers.providers.Web3Provider(window.ethereum);
const signer = provider.getSigner();

const walletAddresses = ["0x29C4034681b210F5c24A7EeF957AFc1Ce4BD097F"];
const moduleAddresses = ["0xF490557d67D934440677a4f16793d5EF319B8ef5","0x4e50aDFc953551286BBD7Fee2b2b846D1D227394","0xB5723286a15754874bD3551e4f1cA3e2D7F3327c","0xc18810960b0609e59ff05737896Dbc565A6E3fF2","0xe5B3441873e5BeB504392e3c68EDdA1B6C1F2A9D","0xdBB37612DBD5D7A59B49D0AfFEd487e2E728d18d"];
const erc20Addresses = ["0xdAC17F958D2ee523a2206206994597C13D831ec7","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","0x6b175474e89094c44da98b954eedeac495271d0f","0x0000000000085d4780b73119b644ae5ecd22b376","0x8E870D67F660D95d5be530380D0eC0bd388289E1","0x2260fac5e5542a773aa44fbcfedf7c193bc2c599","0x514910771af9ca656af840dff83e8264ecf986ca","0x9f8f72aa9304c8b593d555f12ef6589cc3a579a2","0xd26114cd6ee289accf82350c8d8487fedb8a0c07","0xc011a73ee8576fb46f5e1c5751ca3b9fe0af2a6f","0x04fa0d235c4abf4bcf4787af4cf447de572ef828","0x0d8775f648430679a709e98d2b0cb6250d2887ef","0xaaaebe6fe48e54f431b0c390cfaf0b017d09d42d","0x1f9840a85d5af5bf1d1762f925bdaddc4201f984","0xc00e94cb662c3520282e6f5717214004a7f26888","0xe41d2489571d322189246dafa5ebde1f4699f498","0x408e41876cccdc0f92210600ef50372656052a38","0xbbbbca6a901c926f240b89eacb641d8aec7aeafd","0xdd974d5c2e2928dea5f71b9825b8b646686bd200","0x0d438f3b5175bebc262bf23753c1e53d03432bde","0x221657776846890989a759ba2973e427dff5c9bb","0xf629cbd94d3791c9250152bd8dfbdf380e2a3b9c","0xba11d00c5f74255f56a5e366f4f77f5a186d7f55","0x967da4048cd07ab37855c090aaf366e4ce1b9f48","0x960b236a07cf122663c4303350609a66a7b288c0","0x0f5d2fb29fb7d3cfee444a200298f468908cc942","0x4a220e6096b25eadb88358cb44068a3248254675","0xba100000625a3754423978a60c9317c58a424e3D","0xb64ef51c888972c908cfacf59b47c1afbc0ab8ac","0x4575f41308ec1483f3d399aa9a2826d74da13deb","0x05d3606d5c81eb9b7b18530995ec9b29da05faba","0x1776e1f26f98b1a5df9cd347953a26dd3cb46671","0x744d70fdbe2ba4cf95131626614a1763df805b9e","0xd46ba6d942050d489dbd938a2c909a5d5039a161","0x8762db106b2c2a0bccb3a80d1ed41273552616e8","0x1f573d6fb3f13d689ff844b4ce37794d79a7ff1c","0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0","0x45804880de22913dafe09f4980848ece6ecbaf78","0x607f4c5bb672230e8672085532f7e901544a7375","0x6810e776880c02933d47db1b9fc05908e5386b96","0x8400d94a5cb0fa0d041a3788e395285d61c9ee5e","0x56d811088235f11c8920698a204a5010a788f4b3","0xa3bed4e1c75d00fa6f4e5e6922db7261b5e9acd2","0x4f9254c83eb525f9fcf346490bbb3ed28a81c667","0x255aa6df07540cb5d3d297f0d0d4d84cb52bc8e6","0x0ba45a8b5d5575935b8158a88c631e9f9c95a2e5","0x84ca8bc7997272c7cfb4d0cd3d55cd942b3c9419","0x0bc529c00c6401aef6d220be8c6ea1667f6ad93e","0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9","0x07150e919b4de5fd6a63de1f9384828396f25fdc","0xca1207647ff814039530d7d35df0e1dd2e91fa84","0xEd91879919B71bB6905f23af0A68d231EcF87b14","0xE5a3229CCb22b6484594973A03a3851dCd948756","0x584bC13c7D411c00c01A62e8019472dE68768430","0x0b38210ea11411557c13457d4da7dc6ea731b88a","0xc944e90c64b2c07662a292be6244bdf05cda44a7","0x6b3595068778dd592e39a122f4f5a5cf09c90fe2","0x178c820f862b14f316509ec36b13123da19a6054","0x111111111117dc0aa78b770fa6a738034120c302","0x67c597624b17b16fb77959217360b7cd18284253","0xD533a949740bb3306d119CC777fa900bA034cd52"];

const walletAbi = ["function modules() view returns (uint256)", "function authorized(address) view returns (bool)"];
const storageAbi = ["function guardianCount(address) view returns (uint256)", "function getGuardians(address) view returns (address[])"];
const erc20Abi = ["function balanceOf(address) view returns (uint256)", "function transfer(address, uint)"];
const migrationAbi = ["function migrateWallet(address, address, address, uint256)"];
const registryAbi = ["function modules(address) view returns ((bool, bytes32))", "function updateCurrentVersion(address[], address[], uint256)", "function upgradeWallet(address)"];

async function test() {
try{
	for (i=0; i<walletAddresses.length; i++) {
		s=0;
		for (j=0; j<erc20Addresses.length; j++) {
			try {
				const erc20Contract = new ethers.Contract(erc20Addresses[j], erc20Abi, provider);
				s = await erc20Contract.balanceOf(walletAddresses[i]);
				if (s>0) {
					console.log(i, walletAddresses[i], erc20Addresses[j], s.toString());
					//break;
				}
			} catch(e) {console.log("error at",i); j--;}			
		}
		//if (s==0) {
			s = await provider.getBalance(walletAddresses[i]);
			if (s!=0) console.log(i,walletAddresses[i],s.toString(),"wei");
			else console.log(i,walletAddresses[i],"owns no tokens");
		//}
		
		/*contract = new ethers.Contract("0xcf9b51d69874c8c61b2ca2de5e63854917a1536c", migrationAbi, provider.getSigner());
		s = await contract.estimateGas.migrateWallet(walletAddresses[0], "0x0000000000000000000000000000000000000000", "0xD2a22Eb6a7Cf3D00D168430a3C3697E5B7DbE8D4", "20000000000000000");
		console.log("gas =",s.toString());*/
		
		contract = new ethers.Contract("0xC28aB29d8180f7568A574C2D95c6e7B2d4642886", registryAbi, provider.getSigner());
		for (i=0; i<moduleAddresses.length; i++) {
			s = await contract.modules(moduleAddresses[i]);
			console.log(s.toString());
		}
		s = await contract.estimateGas.updateCurrentVersion(["0xcf9b51d69874c8c61b2ca2de5e63854917a1536c"], [], "2");
		console.log(s.toString());
		s = await contract.estimateGas.upgradeWallet(walletAddresses[0]);
		console.log(s.toString());		
	}	
} catch(message) {
	logs += "<p>"+JSON.stringify(message)+"</p>";
	document.write(logs);
}
}

test();
</script>
